% --- Executes on button press in SaveScriptButton.
function SaveScriptButton_Callback(hObject, eventdata, handles)
% hObject    handle to SaveScriptButton (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
NetList_Callback(handles.NetList, eventdata, handles);
Network=handles.Networks{handles.NetList.Value};
Network.Domains=ConnectedDomains(Network.Graph);
PlotNetwork(Network,'domains');

handles.SimulationSettings=callSIMULATIONSETTINGS(handles.SimulationSettings);
if isempty(handles.SimulationSettings)
    return;
end

NewSim.Settings=handles.SimulationSettings;

[NewSim.Time,NewSim.Electrodes]=getELECTRODES(handles,NewSim.Settings,Network);
if isempty(NewSim.Electrodes)
    guidata(hObject,handles);
    return;
end

NewSim.SelDomain=Network.Domains{NewSim.Electrodes.DomIndex(1)};
NewSim.SelLayout=GetSelectedLayout(Network,NewSim.SelDomain);



if ~isequal(0,handles.ResumeCheck.Value) && ~isequal(handles.SimList.String,'SimList')
    IndexNet=handles.NetList.Value;
    IndexSim=handles.SimList.Value;
    SelSim=handles.Networks{IndexNet}.Simulations{IndexSim};
    NewSim.LastW=SelSim.Data.Wmat{end};%%if you want to resume previous simulation
else
    NewSim.LastW=[];
end

NewSim.Name='partialSim';
%% adding just simulation parameters and electrodes to the simulations list
[Network.Simulations,handles.SimList.String,handles.SimList.Value]=...
    AddDeleteDataList('add',Network.Simulations,NewSim);

%% saving in selection folder
Name=Network.Name;
Name=strrep(Name,':','_');
Name=strrep(Name,'/','_');
Name=strcat(Name,'.mat');
SelDir=uigetdir();
if ~isequal(SelDir,0)
    name=fullfile(SelDir,Name);
    save(name,'Network','-v7.3');
else
    return;
end

guidata(hObject,handles);


